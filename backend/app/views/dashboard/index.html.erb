<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard Ferretería</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <%= favicon_link_tag 'favicon.png' %>
  <%= stylesheet_link_tag "dashboard", media: "all" %>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Eczar:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>

  <header>
    <div class="container-header">
      <button class="hamburger" id="hamburger">&#9776;</button>
      <p class="pricipal">Ferremateriales el Maestro - Dashboard</p>
      <% if user_signed_in? %>
        <%= button_to destroy_user_session_path, method: :delete, form: { data: { turbo: true } }, id: "cerrar", class: "logout2" do %>
          <span><i class="fas fa-sign-out-alt"></i></span>
        <% end %>
      <% end %>
    </div>
  </header>

  <nav class="nav-bg">
    <div class="container-nav">
      <ul class="menu" id="menu">
        <li><a href="dashboard"class="link-menu">Inicio</a></li>
        <li><a href="inventario"class="link-menu">Inventario</a></li>
        <li><a href="ventas"class="link-menu">Ventas</a></li>
        <li><a href="proveedores"class="link-menu">Proveedores</a></li>
        <li><a href="clientes"class="link-menu">Clientes</a></li>
      </ul>
      <% if user_signed_in? %>
        <%= button_to "Cerrar sesión", destroy_user_session_path, method: :delete, form: { data: { turbo: true } }, id: "cerrar", class: "logout"%>
      <% end %>
    </div>
  </nav>

    <section class="fondo">
      <div class="welcome">
        <p>¡Bienvenido!</p>
      </div>
    </section>
    <section class="chart-container-base" style="display: flex; justify-content: space-around; gap: 20px; flex-wrap: wrap; padding: 1px;">
      <div class="chart-container1" >
        <canvas id="ventasChart" style></canvas>
      </div>

      <div class="chart-container2" >
        <canvas id="tortaChart"></canvas>
      </div>

      <div class="chart-container3" >
        <canvas id="lineChart"></canvas>
      </div>
    </section>
    <section class="section-card">
    <%= link_to inventario_path, class: "card-link" do %>
      <div class="card">
        <h3>Productos en Stock</h3>
        <p id="stock">0</p>
      </div>
    <% end %>

    <%= link_to ventas_path, class: "card-link" do %>
      <div class="card">
        <h3>Ventas Hoy</h3>
        <p id="ventas">$0</p>
      </div>
    <% end %>

    <%= link_to proveedores_path, class: "card-link" do %>
      <div class="card">
        <h3>Proveedores Registrados</h3>
        <p id="proveedores">0</p>
      </div>
    <% end %>

    <%= link_to clientes_path, class: "card-link" do %>
      <div class="card">
        <h3>Clientes Registrados</h3>
        <p id="clientes">0</p>
      </div>
    <% end %>
  </section>
  <footer>
    &copy; 2025 Ferremateriales el Maestro - v2.3.7
  </footer>
  
<script>
  fetch('/api/v1/ventas_por_dia')
  .then(res => res.json())
  .then(data => {
    const diasTraducidos = {
      Monday: 'Lunes',
      Tuesday: 'Martes',
      Wednesday: 'Miércoles',
      Thursday: 'Jueves',
      Friday: 'Viernes',
      Saturday: 'Sábado',
      Sunday: 'Domingo'
    };

    const labelsTraducidos = data.labels.map(dia => diasTraducidos[dia] || dia);

    new Chart(document.getElementById('ventasChart'), {
      type: 'bar',
      data: {
        labels: labelsTraducidos,
        datasets: [{
          label: 'Ventas por día',
          data: data.valores,
          backgroundColor: 'rgb(70, 130, 180)',
          borderColor: 'black',
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              color: 'white',
              callback: value => '$' + value
            }
          },
          x: {
            ticks: { color: 'white' }
          }
        },
        plugins: {
          legend: { labels: { color: 'white' } }
        }
      }
    });
  });

  

  fetch('/api/v1/inventario_por_categoria')
  .then(res => res.json())
  .then(data => {
    new Chart(document.getElementById('tortaChart'), {
      type: 'pie',
      data: {
        labels: data.labels,
        datasets: [{
          label: 'Inventario por categoría',
          data: data.valores,
          backgroundColor: ['#4A90E2', '#5DADE2', '#85C1E9', '#AED6F1', '#6FB1FC', '#3A78C5'],
          borderColor: 'black',
          borderWidth: 2
        }]
      },
      options: {
        radius: '90%', // <= más pequeño
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              color: '#ffffff',
              font: {
                size: 10 // <= tamaño de texto más pequeño
              }
            }
          }
        }
      }
    });
  });

  fetch('/api/v1/ventas_mensuales')
  .then(res => res.json())
  .then(data => {
    new Chart(document.getElementById('lineChart'), {
      type: 'line',
      data: {
        labels: data.labels, // Asegúrate de que data.labels contenga meses en español
        datasets: [{
          label: 'Ventas mensuales', // Título traducido
          data: data.valores,
          borderColor: 'black',
          backgroundColor: '#3498DB',
          fill: false,
          tension: 0.3
        }]
      },
      options: {
        plugins: {
          legend: {
            labels: {
              color: 'white',
              font: {
                family: 'sans-serif',
                size: 14
              }
            }
          }
        },
        scales: {
          x: {
            ticks: {
              color: '#ffffff',
            }
          },
          y: {
            beginAtZero: true,
            ticks: {
              color: '#ffffff',
              callback: value => '$' + value // formato moneda opcional
            }
          }
        }
      }
    });
  });


  const btn = document.getElementById("hamburger");
  const menu = document.getElementById("menu");

  btn.addEventListener("click", () => {
    menu.classList.toggle("active");
  });

  fetch('/api/v1/dashboard/resumen')
  .then(res => res.json())
  .then(data => {
    document.getElementById('stock').innerText = data.productos_en_stock;
    document.getElementById('ventas').innerText = `$${data.ventas_hoy}`;
    document.getElementById('proveedores').innerText = data.proveedores_registrados;
    document.getElementById('clientes').innerText = data.clientes_registrados;
  });
</script>


</body>
</html>
