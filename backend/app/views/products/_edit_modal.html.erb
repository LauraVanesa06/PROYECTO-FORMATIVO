<!--<div id="edit-modal" class="modal-editar">
  <div class="modal-content2">
    <a href="#" class="close">&times;</a>
    <div class="titulo2">Editar Producto</div>
    <%= form_with(model: Product.new, url: '#', method: :patch, local: true, html: { multipart: true, id: "edit-form" }, class: 'form-editar') do |form| %>
      <%= form.hidden_field :authenticity_token, value: form_authenticity_token %>
      <div class="texto2">
        <%= form.label :imagen, "Imagen:", style: "display: block" %>
        <%= form.file_field :imagen, class: "btn5"%>
      </div>
      <div class="texto2">
        <%= form.label :nombre, "Nombre:", style: "display: block" %>
        <%= form.text_field :nombre, id: 'edit-nombre' %>
      </div>
      <div class="texto2">
        <%= form.label :descripcion, "Descripción:", style: "display: block" %>
        <%= form.text_area :descripcion, id: 'edit-descripcion', class: 'descripcion' %>
      </div>
      <div class="texto2">
        <%= form.label :precio, "Precio:", style: "display: block" %>
        <%= form.text_field :precio, id: 'edit-precio' %>
      </div>
      <div class="texto2">
        <%= form.label :stock, "Stock:", style: "display: block" %>
        <%= form.number_field :stock, id: 'edit-stock' %>
      </div>
      <div class="texto2">
        <%= form.label :category_id, "Categoría:" %>
        <%= form.collection_select :category_id, Category.all, :id, :nombre, { prompt: "Seleccione una categoría" }, id: 'edit-categoria' %> 
      </div>
      <div class="texto2">
        <%= form.label :supplier_id, "Proveedor:" %> 
        <%= form.collection_select :supplier_id, Supplier.all, :id, :nombre, { prompt: "Seleccione un proveedor" }, id: 'edit-proveedor' %> 
      </div>
      <div class="btn3">
        <%= form.submit "Guardar Cambios", class: 'btn4' %>
      </div>
    <% end %>
  </div>
</div>
-->
<div id="edit-modal" class="modal-editar">
  <div class="modal-content2">
    <a href="#" class="close">&times;</a>
    <div id="modal-form-content">
        
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('edit-modal');
    const closeButton = modal.querySelector('.close');

    document.querySelectorAll('.open-edit-modal').forEach(button => {
        button.addEventListener('click', async (event) => {
        event.preventDefault();
        
        const productId = button.dataset.productId;
        
        try {
            const response = await fetch(`/products/${productId}/edit`, {
            headers: {
                'Accept': 'text/html'
            }
            });
            const html = await response.text();
            
            modal.querySelector('#modal-form-content').innerHTML = html;
            
            modal.style.display = 'block';

            const deleteBtn = modal.querySelector('.eliminar');
              if (deleteBtn) {
                deleteBtn.type = "button"; // Para que no envíe el form
                deleteBtn.addEventListener('click', async () => {
                  if (confirm('¿Seguro que quieres eliminar este producto?')) {
                    try {
                      const delResponse = await fetch(`/products/${productId}`, {
                        method: 'DELETE',
                        headers: {
                          'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
                        }
                      });
                      if (delResponse.ok) {
                        modal.style.display = 'none';
                        location.reload(); // Refresca la lista
                      } else {
                        alert('Error al eliminar el producto.');
                      }
                    } catch (err) {
                      console.error('Error:', err);
                    }
                  }
                });
              }

        } catch (error) {
            console.error('Error al obtener el formulario de edición:', error);
        }
        });
    });

    closeButton.addEventListener('click', (event) => {
        event.preventDefault();
        modal.style.display = 'none';
    });

    window.addEventListener('click', (event) => {
        if (event.target === modal) {
        modal.style.display = 'none';
        }
    });
    });

  //cargar imagen 
  document.addEventListener('change', (event) => {
  if (event.target.id === 'file-input') {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = e => {
        let preview = document.querySelector('#image-preview');
        if (!preview) {
          preview = document.createElement('img');
          preview.id = 'image-preview';
          preview.style.maxWidth = '150px';
          preview.style.display = 'block';
          event.target.closest('.drop-container').appendChild(preview);
        }
        preview.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }
  }
});
</script>

