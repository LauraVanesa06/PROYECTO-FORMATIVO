<!--<p style="color: green"><%= notice %></p>

<div>
  <%= link_to "Back to products", inventario_path %>
</div>

<h1><%= @product.nombre %></h1>
<p><%= @product.descripcion %></p>
<p><strong>Precio:</strong> <%= @product.precio %></p>

<% if @product.images.attached? %>
  <div id="carousel" class="carousel" data-current="0" style="max-width:600px; position:relative;">
    <button type="button" class="prev" aria-label="Anterior" style="position:absolute; left:0; top:45%;">‹</button>
    <div class="viewport" style="overflow:hidden;">
      <% @product.images.each_with_index do |img, i| %>
        <%= image_tag img.variant(resize_to_limit: [1000, 1000]).processed,
                      class: (i == 0 ? "slide active" : "slide"),
                      data: { index: i },
                      style: "display:#{i == 0 ? 'block' : 'none'}; width:100%;" %>
      <% end %>
    </div>
    <button type="button" class="next" aria-label="Siguiente" style="position:absolute; right:0; top:45%;">›</button>

    <div class="thumbs" style="display:flex; gap:8px; margin-top:8px; flex-wrap:wrap;">
      <% @product.images.each_with_index do |img, i| %>
        <%= image_tag img.variant(resize_to_limit: [100, 100]).processed,
                      data: { thumb_index: i },
                      style: "cursor:pointer; border:1px solid #ddd; border-radius:6px; padding:2px;" %>
      <% end %>
    </div>
  </div>
<% else %>
  <p>Este producto aún no tiene imágenes.</p>
<% end %>

<script>
  document.addEventListener("DOMContentLoaded", () => {
  const root = document.getElementById("carousel");
  if (!root) return;

  const slides = Array.from(root.querySelectorAll(".slide"));
  const prevBtn = root.querySelector(".prev");
  const nextBtn = root.querySelector(".next");
  const thumbs  = Array.from(root.querySelectorAll("[data-thumb-index]"));
  let current = 0;

  const show = (i) => {
    if (slides.length === 0) return;
    current = (i + slides.length) % slides.length;
    slides.forEach((s, idx) => s.style.display = idx === current ? "block" : "none");
  };

  prevBtn?.addEventListener("click", () => show(current - 1));
  nextBtn?.addEventListener("click", () => show(current + 1));
  thumbs.forEach(t => t.addEventListener("click", () => show(parseInt(t.dataset.thumbIndex, 10))));

  show(0);
});
</script>-->
<!DOCTYPE html>
<html lang="en">
<head>
  <title><%= content_for(:title) || "Appsena" %></title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <%= stylesheet_link_tag "product", media: "all" %>
</head>
<body>

  <section class="container-product">
    <section class="set-img">
      <article>
        <div class="first-img">
          <div class="carousel">
            <% if @product.images.attached? %>
              <% @product.images.each_with_index do |img, i| %>
                <div class="carousel-item <%= 'active' if i == 0 %>">
                  <%= image_tag img, alt: @product.nombre %>
                </div>
              <% end %>
            <% else %>
              <div class="carousel-item active">
                <%= image_tag "ProductoNoDisponible.png", alt: "Sin imagen" %>
              </div>
            <% end %>

            <button class="prev" onclick="moveSlide(-1)">&#10094;</button>
            <button class="next" onclick="moveSlide(1)">&#10095;</button>
          </div>
          <script>
            let currentIndex = 0;
            function moveSlide(step) {
              const items = document.querySelectorAll(".carousel-item");
              items[currentIndex].classList.remove("active");
              currentIndex = (currentIndex + step + items.length) % items.length;
              items[currentIndex].classList.add("active");
            }
          </script>
        </div>
      </article>
    </section>
    <section class="set-info">
      <div class="div-info">
        <div class="d1"><p><%= @product.nombre %></p></div>
        <div class="d2"><p><%= @product.category.nombre %></p></div>
        <div class="d3"><p><%= @product.descripcion %></p></div>
        <div class="cont-stock">
          <div class="cont-img2"></div>
          <div class="stock">
            <div class="d4"><p>Compras</p></div>
            <div class="d5"><p>100 Usuarios</p></div>
          </div>
          <div class="cont-img"></div>
          <div class="stock">
            <div class="d4"><p>Stock</p></div>
            <div class="d5"><p><%= @product.stock %> Unidades</p></div>
          </div>
        </div>
        <article class="carousel-container">
          <% @product.images.drop(1).each do |img| %>
            <div class="all-img">
              <%= image_tag img, alt: @product.nombre %>
            </div>
          <% end %>
        </article>
        <div class="d6"><p>$ <%= @product.precio_cop %> COP</p></div>
        <div class="d7"><p><%= @product.disponible? ? "Disponible" : "No disponible" %></p></div>
      </ul>
      <!--estrellas-->
      <div class="rating">
        <input value="5" name="rating" id="star5" type="radio">
        <label for="star5"></label>
        <input value="4" name="rating" id="star4" type="radio">
        <label for="star4"></label>
        <input value="3" name="rating" id="star3" type="radio">
        <label for="star3"></label>
        <input value="2" name="rating" id="star2" type="radio">
        <label for="star2"></label>
        <input value="1" name="rating" id="star1" type="radio">
        <label for="star1"></label>
      </div>

    </section>
    <section class="set-pago">
      <article class="pago">
        <div class="btns">
          <button class="btn-agg">Agregar al carrito</button>
          <button class="btn-buy">¡Comprar!</button>
        </div>
        <div class="metodo">
          <p class="p1">Metodos de pago</p>
          <p>Tarjeta de Crédito/Débito</p>
          <div class="credito"></div>
          <p>Pago por Tranferencia</p>
          <div class="transferencia"></div>
        </div>
        <div class="direccion">
          <div>dirección:</div>
          <div>Calle 6A No. 11-32</div>
          <div>Cels.: 310 730 6745 - 300 433 4132</div>
          <div>E-mail: ferrecampeche@hotmail.com</div>
        </div>
      </article>
    </section>
  </section>
</body>
</html>