
<div id="edit-modal" class="modal-editar">
  <div class="modal-content2">
    <a href="#" class="close">&times;</a>
    <div class="titulo2">Editar Producto</div>
    <%= form_with(model: product, url: product_path(product), method: :patch, local: true, html: { multipart: true, id: "edit-form" }, class: 'form-editar') do |form| %>
      <div style="color: red">
        <%# No es necesario mostrar errores aquí, ya que el formulario se carga dinámicamente. %>
      </div>

      <div class="texto2">
        <%= form.label :imagen, "Imagen : ", style: "display: block" %>
        <%= form.file_field :imagen, class: "btn5"%>
      </div>

      <div class="texto2">
        <%= form.label :nombre, "Nombre : ", style: "display: block" %>
        <%= form.text_field :nombre, value: product.nombre %>
      </div>

      <div class="texto2">
        <%= form.label :descripcion, "Descripcion : ", style: "display: block" %>
        <%= form.text_area :descripcion, class:'descripcion' %>
      </div>

      <div class="texto2">
        <%= form.label :precio, "Precio : ", style: "display: block" %>
        <%= form.text_field :precio, value: product.precio %>
      </div>

      <div class="texto2">
        <%= form.label :stock, "Stock : ", style: "display: block" %>
        <%= form.number_field :stock, value: product.stock %>
      </div>

      <div class="texto2">
        <%= form.label :category_id, "Categoría : " %>
        <%= form.collection_select :category_id, Category.all, :id, :nombre, selected: product.category_id, prompt: "Seleccione una categoría" %> 
      </div>
      <div class="texto2">
        <%= form.label :provider_id, "Proveedor : " %> 
        <%= form.collection_select :supplier_id, Supplier.all, :id, :nombre, selected: product.supplier_id, prompt: "Seleccione un proveedor" %> 
      </div> 
      <div class="btn3">
        <%= form.submit "Editar", class:'btn4' %>
      </div>
    <% end %>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('edit-modal');
    const closeButton = modal.querySelector('.close');

    // Abrir el modal
    document.querySelectorAll('.open-edit-modal').forEach(button => {
      button.addEventListener('click', (event) => {
        event.preventDefault();
        const productId = button.dataset.productId;
        
        // Obtener los datos del producto (puedes usar un AJAX request aquí si es necesario)
        // Por simplicidad, aquí asumiremos que los datos ya están en la página.
        // Puedes pasar los datos como data-attributes o hacer un fetch a una API.

        // Simulamos la obtención de datos
        const productData = {
            id: productId,
            nombre: `Producto ${productId}`, // Reemplaza con datos reales
            descripcion: `Descripción del Producto ${productId}`, // Reemplaza con datos reales
            precio: 19.99, // Reemplaza con datos reales
            stock: 50, // Reemplaza con datos reales
            category_id: 1, // Reemplaza con datos reales
            supplier_id: 1, // Reemplaza con datos reales
        };

        // Actualizar el formulario dentro del modal
        const form = modal.querySelector('#edit-form');
        form.action = `/products/${productId}`; // Actualiza la URL del formulario
        
        form.querySelector('#product_nombre').value = productData.nombre;
        form.querySelector('#product_descripcion').value = productData.descripcion;
        form.querySelector('#product_precio').value = productData.precio;
        form.querySelector('#product_stock').value = productData.stock;
        form.querySelector('#product_category_id').value = productData.category_id;
        form.querySelector('#product_supplier_id').value = productData.supplier_id;

        // Mostrar el modal
        modal.style.display = 'block';
      });
    });

    // Cerrar el modal
    closeButton.addEventListener('click', (event) => {
      event.preventDefault();
      modal.style.display = 'none';
    });

    window.addEventListener('click', (event) => {
      if (event.target === modal) {
        modal.style.display = 'none';
      }
    });
  });
</script>